<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>瓷砖库存管理系统 - iOS 导航栏版（含管理员）</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getDatabase, ref, set, onValue, get } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";
const firebaseConfig = {
  apiKey: "AIzaSyC65DEOgj4WeksRRVmw4ZTrNkCB83SoQpI",
  authDomain: "tile-management-system-f5db8.firebaseapp.com",
  databaseURL: "https://tile-management-system-f5db8-default-rtdb.firebaseio.com",
  projectId: "tile-management-system-f5db8",
  storageBucket: "tile-management-system-f5db8.appspot.com",
  messagingSenderId: "925027091187",
  appId: "1:925027091187:web:a2bb160b629f541abded86"
};
try {
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const stockRef = ref(database, 'tileStock');
  window.firebase = { app, database, ref, set, onValue, get, stockRef };
  window.firebaseInitialized = true;
} catch(e){ window.firebaseInitialized=false; window.firebaseError=e.message; }
</script>

<style>
:root {
  --primary: #007AFF;
  --bg: #F8FAFC;
  --card-bg: #FFFFFF;
  --radius: 16px;
  --shadow: 0 4px 12px rgba(0,0,0,0.08);
  font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
}
body { background: var(--bg); margin:0; padding:80px 16px 16px; color:#111; }
.navbar {
  position:fixed;top:0;left:0;right:0;height:64px;
  backdrop-filter: blur(12px);
  background:rgba(0,122,255,0.75);
  display:flex;align-items:center;justify-content:space-between;
  padding:0 12px;color:white;z-index:999;border-bottom:1px solid rgba(255,255,255,0.2);
}
.navbar h1 { font-size:17px;font-weight:600;margin:0; }
.nav-tabs { display:flex;gap:6px; }
.nav-tabs button {
  background:transparent;border:0;color:white;font-size:15px;padding:6px 10px;border-radius:10px;
}
.nav-tabs button.active { background:rgba(255,255,255,0.25); }
.card { background: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow); padding:16px; margin-bottom:16px; }
h3 { color: var(--primary); margin: 0 0 4px; }
.thai { color:#666; font-size:13px; margin-bottom:10px; }
label { display:block; margin:8px 0 4px; font-weight:500; }
input { width:100%; padding:10px; border:1px solid #dcdcdc; border-radius:10px; font-size:15px; }
button { background: var(--primary); color:white; border:none; border-radius:10px; padding:10px; font-size:15px; cursor:pointer; }
button.secondary { background:#34C759; }
button.ghost { background:#f1f5f9; color:#111; border:1px solid #e6e9ef; }
.controls { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
.table-container { overflow-x:auto; -webkit-overflow-scrolling:touch; margin-top:10px; }
table { width:100%; border-collapse:collapse; font-size:14px; }
th,td { padding:8px; border-bottom:1px solid #eee; text-align:left; }
th { background:var(--primary); color:white; }
.item { background:#fbfdff; border-radius:10px; padding:10px; margin-bottom:10px; border:1px solid #eef3fb; }
.mini-query { display:flex; align-items:center; gap:8px; }
.mini-query input { flex:1; }
.toast { position:fixed; bottom:30px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.75); color:white; padding:12px 20px; border-radius:20px; font-size:15px; display:none; z-index:9999; }
footer { text-align:center; color:#666; font-size:13px; margin:30px 0 10px; }
pre { background:#0f172a; color:white; border-radius:10px; padding:12px; white-space:pre-wrap; font-size:14px; overflow:auto; }
</style>
</head>
<body>
<div class="navbar">
  <h1>瓷砖库存管理系统</h1>
  <div class="nav-tabs">
    <button class="tabbtn active" data-tab="search">📊</button>
    <button class="tabbtn" data-tab="chuhuo">📦</button>
    <button class="tabbtn" data-tab="haiyun">🚢</button>
  </div>
</div>

<div id="search" class="tab card">
  <h3>📊 库存查询</h3>
  <div class="thai">(ตรวจสอบสต็อกสินค้า)</div>
  <input id="stockCode" placeholder="输入编号关键词">
  <div class="controls">
    <button id="btnSearch">查询库存<br><span class='thai'>(ตรวจสอบสต็อก)</span></button>
    <button class="secondary" id="btnRefresh">刷新数据<br><span class='thai'>(รีเฟรชข้อมูล)</span></button>
  </div>
  <div id="lastUpdate" style="margin-top:8px;color:#555;font-size:13px;">库存最后更新时间：加载中...</div>
  <div class="table-container">
    <table id="stockTable" style="display:none">
      <thead><tr><th>编号</th><th>色号</th><th>数量(箱)</th><th>仓库</th></tr></thead>
      <tbody id="stockBody"></tbody>
    </table>
    <div id="stockMsg" style="color:#777;">请输入编号并点击查询</div>
  </div>
</div>

<div id="chuhuo" class="tab card" style="display:none">
  <h3>📦 出货计划</h3>
  <div class="thai">(แผนการจัดส่งสินค้า)</div>
  <label>日期</label><input id="ch_date" type="date">
  <label>单位或车牌</label><input id="ch_vehicle" type="text">
  <label>客户</label><input id="ch_customer" type="text">
  <div id="ch_items"></div>
  <div class="controls">
    <button id="ch_add">+ 添加货项<br><span class='thai'>(+ เพิ่มรายการสินค้า)</span></button>
    <button id="ch_gen" class="ghost">生成文字<br><span class='thai'>(สร้างข้อความ)</span></button>
    <button id="ch_copy" class="secondary">复制<br><span class='thai'>(คัดลอก)</span></button>
  </div>
  <pre id="ch_result">（请先填写表单）</pre>
</div>

<div id="haiyun" class="tab card" style="display:none">
  <h3>🚢 海运入库</h3>
  <div class="thai">(นำเข้าสินค้าทางเรือ)</div>
  <label>日期</label><input id="hy_date" type="date">
  <label>柜号</label><input id="hy_container" type="text">
  <div id="hy_items"></div>
  <div class="controls">
    <button id="hy_add">+ 添加货项<br><span class='thai'>(+ เพิ่มรายการสินค้า)</span></button>
    <button id="hy_gen" class="ghost">生成文字<br><span class='thai'>(สร้างข้อความ)</span></button>
    <button id="hy_copy" class="secondary">复制<br><span class='thai'>(คัดลอก)</span></button>
  </div>
  <pre id="hy_result">（请先填写表单）</pre>
</div>

<!-- 管理员功能 -->
<div class="card">
  <h3>🔐 管理员功能</h3>
  <div class="thai">(สำหรับผู้ดูแลระบบ)</div>
  <label>管理员密码</label><input id="adminPw" type="password" placeholder="输入密码">
  <div class="controls">
    <button id="adminLogin">登录<br><span class='thai'>(เข้าสู่ระบบ)</span></button>
    <button id="adminLogout" class="ghost" style="display:none">退出<br><span class='thai'>(ออกจากระบบ)</span></button>
  </div>
  <div id="adminArea" style="display:none;margin-top:10px;">
    <input id="excelInput" type="file" accept=".xlsx,.xls">
    <button id="btnSave" class="secondary">保存并写入 Firebase<br><span class='thai'>(บันทึกข้อมูล)</span></button>
  </div>
</div>

<div class="toast" id="toast"></div>
<footer>仅限内部使用 | Designed by Kyson</footer>

<script>
(function(){
const tabs=document.querySelectorAll('.tabbtn');
tabs.forEach(b=>b.onclick=()=>{tabs.forEach(x=>x.classList.remove('active'));b.classList.add('active');document.querySelectorAll('.tab').forEach(t=>t.style.display='none');document.getElementById(b.dataset.tab).style.display='block';});
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.style.display='block';setTimeout(()=>t.style.display='none',2500);}
let stockData=[];
async function loadStock(){
 if(!window.firebase){toast('Firebase 未初始化');return;}
 const snap=await window.firebase.get(window.firebase.stockRef);
 const val=snap.val();if(val&&val.stockData){stockData=val.stockData;document.getElementById('lastUpdate').textContent='库存最后更新时间：'+val.updateTime;toast('已加载库存');}
}
document.getElementById('btnRefresh').onclick=loadStock;
document.getElementById('btnSearch').onclick=()=>{
 const key=document.getElementById('stockCode').value.trim().toLowerCase();
 const t=document.getElementById('stockTable'),b=document.getElementById('stockBody'),m=document.getElementById('stockMsg');
 b.innerHTML='';t.style.display='none';m.textContent='';
 if(!key){m.textContent='请输入编号';return;}
 const res=stockData.filter(i=>i.code&&i.code.toLowerCase().includes(key));
 if(!res.length){m.textContent='未找到结果';return;}
 res.forEach(r=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${r.code}</td><td>${r.color||'-'}</td><td>${r.quantity||0}</td><td>${r.warehouse||''}</td>`;b.appendChild(tr);});
 t.style.display='table';
};
// 出货计划
const chDiv=document.getElementById('ch_items');
function addCh(){
 const d=document.createElement('div');d.className='item';
 d.innerHTML=`<div class='mini-query'><div style='flex:1'><label>ကုဒ်နိပတ်/编号</label><input class='ch-code'></div><button class='ch-search'>查询库存</button></div><div class='mini-res'></div><label>အရောင်ကုဒ်色号</label><input class='ch-color'><label>အလျားအနံ/规格</label><input class='ch-spec'><label>အရေအတွက်/数量</label><input class='ch-qty'>`;
 chDiv.appendChild(d);
 d.querySelector('.ch-search').onclick=()=>{
   const code=d.querySelector('.ch-code').value.trim().toLowerCase();
   const resDiv=d.querySelector('.mini-res');
   if(!code){resDiv.textContent='请输入编号';return;}
   const res=stockData.filter(i=>i.code&&i.code.toLowerCase().includes(code));
   if(!res.length){resDiv.textContent='未找到库存信息';return;}
   let html='<div class="table-container"><table><thead><tr><th>编号</th><th>色号</th><th>数量(箱)</th><th>仓库</th></tr></thead><tbody>';
   res.forEach(r=>html+=`<tr><td>${r.code}</td><td>${r.color||'-'}</td><td>${r.quantity||0}</td><td>${r.warehouse||''}</td></tr>`);
   html+='</tbody></table></div>';resDiv.innerHTML=html;
 };
}
addCh();
document.getElementById('ch_add').onclick=addCh;
document.getElementById('ch_gen').onclick=()=>{
 const date=document.getElementById('ch_date').value,car=document.getElementById('ch_vehicle').value,cus=document.getElementById('ch_customer').value;
 let txt=`出货计划\n日期：${date}\n单位或车牌：${car}\n客户：${cus}\n\n`;
 [...chDiv.children].forEach((it,i)=>{const c=it.querySelector('.ch-code').value,col=it.querySelector('.ch-color').value,s=it.querySelector('.ch-spec').value,q=it.querySelector('.ch-qty').value;txt+=`${i+1}.ကုဒ်နိပတ်/编号：${c}\nအရောင်ကုဒ်色号：${col}\nအလျားအနံ/规格：${s}\nအရေအတွက်/数量：${q}\n\n`;});
 document.getElementById('ch_result').textContent=txt;toast('已生成出货计划');
};
document.getElementById('ch_copy').onclick=()=>{navigator.clipboard.writeText(document.getElementById('ch_result').textContent);toast('已复制');};
// 海运入库
const hyDiv=document.getElementById('hy_items');
function addHy(){const d=document.createElement('div');d.className='item';d.innerHTML='<label>ကုဒ်နိပတ်/编号</label><input><label>အလျားအနံ/规格</label><input><label>အရောင်ကုဒ်色号</label><input><label>အရေအတွက်/数量</label><input>';hyDiv.appendChild(d);}
addHy();
document.getElementById('hy_add').onclick=addHy;
document.getElementById('hy_gen').onclick=()=>{
 const date=document.getElementById('hy_date').value,con=document.getElementById('hy_container').value;
 let txt=`海运入库：\n日期：${date}\n柜号：${con}\n\n`;
 [...hyDiv.children].forEach((it,i)=>{const v=it.querySelectorAll('input');txt+=`${i+1}.ကုဒ်နိပတ်/编号：${v[0].value}\nအလျားအနံ/规格：${v[1].value}\nအရောင်ကုဒ်色号：${v[2].value}\nအရေအတွက်/数量：${v[3].value}\n\n`;});
 document.getElementById('hy_result').textContent=txt;toast('已生成海运入库');
};
document.getElementById('hy_copy').onclick=()=>{navigator.clipboard.writeText(document.getElementById('hy_result').textContent);toast('已复制');};
// 管理员
document.getElementById('adminLogin').onclick=()=>{
 const pw=document.getElementById('adminPw').value.trim();
 if(pw==='admin'){document.getElementById('adminArea').style.display='block';document.getElementById('adminLogout').style.display='inline-block';toast('管理员已登录');}
 else toast('密码错误');
};
document.getElementById('adminLogout').onclick=()=>{document.getElementById('adminArea').style.display='none';document.getElementById('adminLogout').style.display='none';toast('已退出');};
document.getElementById('btnSave').onclick=async()=>{
 const f=document.getElementById('excelInput').files[0];if(!f){toast('请选择Excel');return;}
 const r=new FileReader();r.onload=async(e)=>{const wb=XLSX.read(new Uint8Array(e.target.result),{type:'array'});let list=[];wb.SheetNames.forEach(n=>{const ws=wb.Sheets[n];const rows=XLSX.utils.sheet_to_json(ws,{header:1});rows.forEach(row=>{if(row[1]&&String(row[1]).includes('กระเบื้อง')){list.push({code:String(row[1]),color:String(row[2]||''),quantity:row[9]||0,warehouse:n});}});});await window.firebase.set(window.firebase.stockRef,{stockData:list,updateTime:new Date().toLocaleString()});toast('已保存');};
 r.readAsArrayBuffer(f);
};
setTimeout(()=>{if(window.firebaseInitialized)loadStock();},600);
})(); 
</script>
</body>
</html>

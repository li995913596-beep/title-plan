<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>ç“·ç –åº“å­˜ç®¡ç†ç³»ç»Ÿ - iOS å¯¼èˆªæ ç‰ˆï¼ˆå«ç®¡ç†å‘˜ï¼‰</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getDatabase, ref, set, onValue, get } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";
const firebaseConfig = {
  apiKey: "AIzaSyC65DEOgj4WeksRRVmw4ZTrNkCB83SoQpI",
  authDomain: "tile-management-system-f5db8.firebaseapp.com",
  databaseURL: "https://tile-management-system-f5db8-default-rtdb.firebaseio.com",
  projectId: "tile-management-system-f5db8",
  storageBucket: "tile-management-system-f5db8.appspot.com",
  messagingSenderId: "925027091187",
  appId: "1:925027091187:web:a2bb160b629f541abded86"
};
try {
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const stockRef = ref(database, 'tileStock');
  window.firebase = { app, database, ref, set, onValue, get, stockRef };
  window.firebaseInitialized = true;
} catch(e){ window.firebaseInitialized=false; window.firebaseError=e.message; }
</script>

<style>
:root {
  --primary: #007AFF;
  --bg: #F8FAFC;
  --card-bg: #FFFFFF;
  --radius: 16px;
  --shadow: 0 4px 12px rgba(0,0,0,0.08);
  font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, sans-serif;
}
body { background: var(--bg); margin:0; padding:80px 16px 16px; color:#111; }
.navbar {
  position:fixed;top:0;left:0;right:0;height:64px;
  backdrop-filter: blur(12px);
  background:rgba(0,122,255,0.75);
  display:flex;align-items:center;justify-content:space-between;
  padding:0 12px;color:white;z-index:999;border-bottom:1px solid rgba(255,255,255,0.2);
}
.navbar h1 { font-size:17px;font-weight:600;margin:0; }
.nav-tabs { display:flex;gap:6px; }
.nav-tabs button {
  background:transparent;border:0;color:white;font-size:15px;padding:6px 10px;border-radius:10px;
}
.nav-tabs button.active { background:rgba(255,255,255,0.25); }
.card { background: var(--card-bg); border-radius: var(--radius); box-shadow: var(--shadow); padding:16px; margin-bottom:16px; }
h3 { color: var(--primary); margin: 0 0 4px; }
.thai { color:#666; font-size:13px; margin-bottom:10px; }
label { display:block; margin:8px 0 4px; font-weight:500; }
input { width:100%; padding:10px; border:1px solid #dcdcdc; border-radius:10px; font-size:15px; }
button { background: var(--primary); color:white; border:none; border-radius:10px; padding:10px; font-size:15px; cursor:pointer; }
button.secondary { background:#34C759; }
button.ghost { background:#f1f5f9; color:#111; border:1px solid #e6e9ef; }
.controls { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
.table-container { overflow-x:auto; -webkit-overflow-scrolling:touch; margin-top:10px; }
table { width:100%; border-collapse:collapse; font-size:14px; }
th,td { padding:8px; border-bottom:1px solid #eee; text-align:left; }
th { background:var(--primary); color:white; }
.item { background:#fbfdff; border-radius:10px; padding:10px; margin-bottom:10px; border:1px solid #eef3fb; }
.mini-query { display:flex; align-items:center; gap:8px; }
.mini-query input { flex:1; }
.toast { position:fixed; bottom:30px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.75); color:white; padding:12px 20px; border-radius:20px; font-size:15px; display:none; z-index:9999; }
footer { text-align:center; color:#666; font-size:13px; margin:30px 0 10px; }
pre { background:#0f172a; color:white; border-radius:10px; padding:12px; white-space:pre-wrap; font-size:14px; overflow:auto; }
</style>
</head>
<body>
<div class="navbar">
  <h1>ç“·ç –åº“å­˜ç®¡ç†ç³»ç»Ÿ</h1>
  <div class="nav-tabs">
    <button class="tabbtn active" data-tab="search">ğŸ“Š</button>
    <button class="tabbtn" data-tab="chuhuo">ğŸ“¦</button>
    <button class="tabbtn" data-tab="haiyun">ğŸš¢</button>
  </div>
</div>

<div id="search" class="tab card">
  <h3>ğŸ“Š åº“å­˜æŸ¥è¯¢</h3>
  <div class="thai">(à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸•à¹‡à¸­à¸à¸ªà¸´à¸™à¸„à¹‰à¸²)</div>
  <input id="stockCode" placeholder="è¾“å…¥ç¼–å·å…³é”®è¯">
  <div class="controls">
    <button id="btnSearch">æŸ¥è¯¢åº“å­˜<br><span class='thai'>(à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸•à¹‡à¸­à¸)</span></button>
    <button class="secondary" id="btnRefresh">åˆ·æ–°æ•°æ®<br><span class='thai'>(à¸£à¸µà¹€à¸Ÿà¸£à¸Šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥)</span></button>
  </div>
  <div id="lastUpdate" style="margin-top:8px;color:#555;font-size:13px;">åº“å­˜æœ€åæ›´æ–°æ—¶é—´ï¼šåŠ è½½ä¸­...</div>
  <div class="table-container">
    <table id="stockTable" style="display:none">
      <thead><tr><th>ç¼–å·</th><th>è‰²å·</th><th>æ•°é‡(ç®±)</th><th>ä»“åº“</th></tr></thead>
      <tbody id="stockBody"></tbody>
    </table>
    <div id="stockMsg" style="color:#777;">è¯·è¾“å…¥ç¼–å·å¹¶ç‚¹å‡»æŸ¥è¯¢</div>
  </div>
</div>

<div id="chuhuo" class="tab card" style="display:none">
  <h3>ğŸ“¦ å‡ºè´§è®¡åˆ’</h3>
  <div class="thai">(à¹à¸œà¸™à¸à¸²à¸£à¸ˆà¸±à¸”à¸ªà¹ˆà¸‡à¸ªà¸´à¸™à¸„à¹‰à¸²)</div>
  <label>æ—¥æœŸ</label><input id="ch_date" type="date">
  <label>å•ä½æˆ–è½¦ç‰Œ</label><input id="ch_vehicle" type="text">
  <label>å®¢æˆ·</label><input id="ch_customer" type="text">
  <div id="ch_items"></div>
  <div class="controls">
    <button id="ch_add">+ æ·»åŠ è´§é¡¹<br><span class='thai'>(+ à¹€à¸à¸´à¹ˆà¸¡à¸£à¸²à¸¢à¸à¸²à¸£à¸ªà¸´à¸™à¸„à¹‰à¸²)</span></button>
    <button id="ch_gen" class="ghost">ç”Ÿæˆæ–‡å­—<br><span class='thai'>(à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡)</span></button>
    <button id="ch_copy" class="secondary">å¤åˆ¶<br><span class='thai'>(à¸„à¸±à¸”à¸¥à¸­à¸)</span></button>
  </div>
  <pre id="ch_result">ï¼ˆè¯·å…ˆå¡«å†™è¡¨å•ï¼‰</pre>
</div>

<div id="haiyun" class="tab card" style="display:none">
  <h3>ğŸš¢ æµ·è¿å…¥åº“</h3>
  <div class="thai">(à¸™à¸³à¹€à¸‚à¹‰à¸²à¸ªà¸´à¸™à¸„à¹‰à¸²à¸—à¸²à¸‡à¹€à¸£à¸·à¸­)</div>
  <label>æ—¥æœŸ</label><input id="hy_date" type="date">
  <label>æŸœå·</label><input id="hy_container" type="text">
  <div id="hy_items"></div>
  <div class="controls">
    <button id="hy_add">+ æ·»åŠ è´§é¡¹<br><span class='thai'>(+ à¹€à¸à¸´à¹ˆà¸¡à¸£à¸²à¸¢à¸à¸²à¸£à¸ªà¸´à¸™à¸„à¹‰à¸²)</span></button>
    <button id="hy_gen" class="ghost">ç”Ÿæˆæ–‡å­—<br><span class='thai'>(à¸ªà¸£à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡)</span></button>
    <button id="hy_copy" class="secondary">å¤åˆ¶<br><span class='thai'>(à¸„à¸±à¸”à¸¥à¸­à¸)</span></button>
  </div>
  <pre id="hy_result">ï¼ˆè¯·å…ˆå¡«å†™è¡¨å•ï¼‰</pre>
</div>

<!-- ç®¡ç†å‘˜åŠŸèƒ½ -->
<div class="card">
  <h3>ğŸ” ç®¡ç†å‘˜åŠŸèƒ½</h3>
  <div class="thai">(à¸ªà¸³à¸«à¸£à¸±à¸šà¸œà¸¹à¹‰à¸”à¸¹à¹à¸¥à¸£à¸°à¸šà¸š)</div>
  <label>ç®¡ç†å‘˜å¯†ç </label><input id="adminPw" type="password" placeholder="è¾“å…¥å¯†ç ">
  <div class="controls">
    <button id="adminLogin">ç™»å½•<br><span class='thai'>(à¹€à¸‚à¹‰à¸²à¸ªà¸¹à¹ˆà¸£à¸°à¸šà¸š)</span></button>
    <button id="adminLogout" class="ghost" style="display:none">é€€å‡º<br><span class='thai'>(à¸­à¸­à¸à¸ˆà¸²à¸à¸£à¸°à¸šà¸š)</span></button>
  </div>
  <div id="adminArea" style="display:none;margin-top:10px;">
    <input id="excelInput" type="file" accept=".xlsx,.xls">
    <button id="btnSave" class="secondary">ä¿å­˜å¹¶å†™å…¥ Firebase<br><span class='thai'>(à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥)</span></button>
  </div>
</div>

<div class="toast" id="toast"></div>
<footer>ä»…é™å†…éƒ¨ä½¿ç”¨ | Designed by Kyson</footer>

<script>
(function(){
const tabs=document.querySelectorAll('.tabbtn');
tabs.forEach(b=>b.onclick=()=>{tabs.forEach(x=>x.classList.remove('active'));b.classList.add('active');document.querySelectorAll('.tab').forEach(t=>t.style.display='none');document.getElementById(b.dataset.tab).style.display='block';});
function toast(m){const t=document.getElementById('toast');t.textContent=m;t.style.display='block';setTimeout(()=>t.style.display='none',2500);}
let stockData=[];
async function loadStock(){
 if(!window.firebase){toast('Firebase æœªåˆå§‹åŒ–');return;}
 const snap=await window.firebase.get(window.firebase.stockRef);
 const val=snap.val();if(val&&val.stockData){stockData=val.stockData;document.getElementById('lastUpdate').textContent='åº“å­˜æœ€åæ›´æ–°æ—¶é—´ï¼š'+val.updateTime;toast('å·²åŠ è½½åº“å­˜');}
}
document.getElementById('btnRefresh').onclick=loadStock;
document.getElementById('btnSearch').onclick=()=>{
 const key=document.getElementById('stockCode').value.trim().toLowerCase();
 const t=document.getElementById('stockTable'),b=document.getElementById('stockBody'),m=document.getElementById('stockMsg');
 b.innerHTML='';t.style.display='none';m.textContent='';
 if(!key){m.textContent='è¯·è¾“å…¥ç¼–å·';return;}
 const res=stockData.filter(i=>i.code&&i.code.toLowerCase().includes(key));
 if(!res.length){m.textContent='æœªæ‰¾åˆ°ç»“æœ';return;}
 res.forEach(r=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${r.code}</td><td>${r.color||'-'}</td><td>${r.quantity||0}</td><td>${r.warehouse||''}</td>`;b.appendChild(tr);});
 t.style.display='table';
};
// å‡ºè´§è®¡åˆ’
const chDiv=document.getElementById('ch_items');
function addCh(){
 const d=document.createElement('div');d.className='item';
 d.innerHTML=`<div class='mini-query'><div style='flex:1'><label>á€€á€¯á€’á€ºá€”á€­á€•á€á€º/ç¼–å·</label><input class='ch-code'></div><button class='ch-search'>æŸ¥è¯¢åº“å­˜</button></div><div class='mini-res'></div><label>á€¡á€›á€±á€¬á€„á€ºá€€á€¯á€’á€ºè‰²å·</label><input class='ch-color'><label>á€¡á€œá€»á€¬á€¸á€¡á€”á€¶/è§„æ ¼</label><input class='ch-spec'><label>á€¡á€›á€±á€¡á€á€½á€€á€º/æ•°é‡</label><input class='ch-qty'>`;
 chDiv.appendChild(d);
 d.querySelector('.ch-search').onclick=()=>{
   const code=d.querySelector('.ch-code').value.trim().toLowerCase();
   const resDiv=d.querySelector('.mini-res');
   if(!code){resDiv.textContent='è¯·è¾“å…¥ç¼–å·';return;}
   const res=stockData.filter(i=>i.code&&i.code.toLowerCase().includes(code));
   if(!res.length){resDiv.textContent='æœªæ‰¾åˆ°åº“å­˜ä¿¡æ¯';return;}
   let html='<div class="table-container"><table><thead><tr><th>ç¼–å·</th><th>è‰²å·</th><th>æ•°é‡(ç®±)</th><th>ä»“åº“</th></tr></thead><tbody>';
   res.forEach(r=>html+=`<tr><td>${r.code}</td><td>${r.color||'-'}</td><td>${r.quantity||0}</td><td>${r.warehouse||''}</td></tr>`);
   html+='</tbody></table></div>';resDiv.innerHTML=html;
 };
}
addCh();
document.getElementById('ch_add').onclick=addCh;
document.getElementById('ch_gen').onclick=()=>{
 const date=document.getElementById('ch_date').value,car=document.getElementById('ch_vehicle').value,cus=document.getElementById('ch_customer').value;
 let txt=`å‡ºè´§è®¡åˆ’\næ—¥æœŸï¼š${date}\nå•ä½æˆ–è½¦ç‰Œï¼š${car}\nå®¢æˆ·ï¼š${cus}\n\n`;
 [...chDiv.children].forEach((it,i)=>{const c=it.querySelector('.ch-code').value,col=it.querySelector('.ch-color').value,s=it.querySelector('.ch-spec').value,q=it.querySelector('.ch-qty').value;txt+=`${i+1}.á€€á€¯á€’á€ºá€”á€­á€•á€á€º/ç¼–å·ï¼š${c}\ná€¡á€›á€±á€¬á€„á€ºá€€á€¯á€’á€ºè‰²å·ï¼š${col}\ná€¡á€œá€»á€¬á€¸á€¡á€”á€¶/è§„æ ¼ï¼š${s}\ná€¡á€›á€±á€¡á€á€½á€€á€º/æ•°é‡ï¼š${q}\n\n`;});
 document.getElementById('ch_result').textContent=txt;toast('å·²ç”Ÿæˆå‡ºè´§è®¡åˆ’');
};
document.getElementById('ch_copy').onclick=()=>{navigator.clipboard.writeText(document.getElementById('ch_result').textContent);toast('å·²å¤åˆ¶');};
// æµ·è¿å…¥åº“
const hyDiv=document.getElementById('hy_items');
function addHy(){const d=document.createElement('div');d.className='item';d.innerHTML='<label>á€€á€¯á€’á€ºá€”á€­á€•á€á€º/ç¼–å·</label><input><label>á€¡á€œá€»á€¬á€¸á€¡á€”á€¶/è§„æ ¼</label><input><label>á€¡á€›á€±á€¬á€„á€ºá€€á€¯á€’á€ºè‰²å·</label><input><label>á€¡á€›á€±á€¡á€á€½á€€á€º/æ•°é‡</label><input>';hyDiv.appendChild(d);}
addHy();
document.getElementById('hy_add').onclick=addHy;
document.getElementById('hy_gen').onclick=()=>{
 const date=document.getElementById('hy_date').value,con=document.getElementById('hy_container').value;
 let txt=`æµ·è¿å…¥åº“ï¼š\næ—¥æœŸï¼š${date}\næŸœå·ï¼š${con}\n\n`;
 [...hyDiv.children].forEach((it,i)=>{const v=it.querySelectorAll('input');txt+=`${i+1}.á€€á€¯á€’á€ºá€”á€­á€•á€á€º/ç¼–å·ï¼š${v[0].value}\ná€¡á€œá€»á€¬á€¸á€¡á€”á€¶/è§„æ ¼ï¼š${v[1].value}\ná€¡á€›á€±á€¬á€„á€ºá€€á€¯á€’á€ºè‰²å·ï¼š${v[2].value}\ná€¡á€›á€±á€¡á€á€½á€€á€º/æ•°é‡ï¼š${v[3].value}\n\n`;});
 document.getElementById('hy_result').textContent=txt;toast('å·²ç”Ÿæˆæµ·è¿å…¥åº“');
};
document.getElementById('hy_copy').onclick=()=>{navigator.clipboard.writeText(document.getElementById('hy_result').textContent);toast('å·²å¤åˆ¶');};
// ç®¡ç†å‘˜
document.getElementById('adminLogin').onclick=()=>{
 const pw=document.getElementById('adminPw').value.trim();
 if(pw==='admin'){document.getElementById('adminArea').style.display='block';document.getElementById('adminLogout').style.display='inline-block';toast('ç®¡ç†å‘˜å·²ç™»å½•');}
 else toast('å¯†ç é”™è¯¯');
};
document.getElementById('adminLogout').onclick=()=>{document.getElementById('adminArea').style.display='none';document.getElementById('adminLogout').style.display='none';toast('å·²é€€å‡º');};
document.getElementById('btnSave').onclick=async()=>{
 const f=document.getElementById('excelInput').files[0];if(!f){toast('è¯·é€‰æ‹©Excel');return;}
 const r=new FileReader();r.onload=async(e)=>{const wb=XLSX.read(new Uint8Array(e.target.result),{type:'array'});let list=[];wb.SheetNames.forEach(n=>{const ws=wb.Sheets[n];const rows=XLSX.utils.sheet_to_json(ws,{header:1});rows.forEach(row=>{if(row[1]&&String(row[1]).includes('à¸à¸£à¸°à¹€à¸šà¸·à¹‰à¸­à¸‡')){list.push({code:String(row[1]),color:String(row[2]||''),quantity:row[9]||0,warehouse:n});}});});await window.firebase.set(window.firebase.stockRef,{stockData:list,updateTime:new Date().toLocaleString()});toast('å·²ä¿å­˜');};
 r.readAsArrayBuffer(f);
};
setTimeout(()=>{if(window.firebaseInitialized)loadStock();},600);
})(); 
</script>
</body>
</html>
